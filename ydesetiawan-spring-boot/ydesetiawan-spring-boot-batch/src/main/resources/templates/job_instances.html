<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
<title th:text="${@environment.getProperty('application_name')}"></title>

<!-- Bootstrap Core CSS -->
<link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

<!-- MetisMenu CSS -->
<link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet" />

<!-- DataTables CSS -->
<link href="../vendor/datatables-plugins/dataTables.bootstrap.css"
	rel="stylesheet" />

<!-- DataTables Responsive CSS -->
<link href="../vendor/datatables-responsive/dataTables.responsive.css"
	rel="stylesheet" />

<!-- Custom CSS -->
<link href="../dist/css/sb-admin-2.css" rel="stylesheet" />

<!-- Custom Fonts -->
<link href="../vendor/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css" />

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>

	<div id="wrapper">
		<div th:replace="layout-dashboard :: navbar"></div>

		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header">Job Scheduler</h1>
				</div>
				<!-- /.row -->
				<div class="col-lg-12">
					<section>
						<div th:if="${alertSuccess}" class="alert alert-success fade in">
							<a href="#" class="close" data-dismiss="alert">&times;</a><span
								th:text="${alertSuccess}">Success message.</span>
						</div>
						<div th:if="${alertWarning}" class="alert alert-warning fade in">
							<a href="#" class="close" data-dismiss="alert">&times;</a><span
								th:text="${alertWarning}">Warning message.</span>
						</div>
						<table class="table table-striped table-bordered table-hover"
							th:if="${not #lists.isEmpty(job_name_instances)}">
							<thead>
								<tr>
									<th><span>Job Name</span></th>
									<th><span>Last Run Time</span></th>
									<th><span>Next Run Time</span></th>
									<th><span>Last Result</span></th>
									<th><span>Action</span></th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="job_name_instance : ${job_name_instances}">
									<td
										th:if="${@environment.getProperty('job_name.jobs.'+job_name_instance.key)==null}"
										th:text="${job_name_instance.key}">job name</td>
									<td
										th:unless="${@environment.getProperty('job_name.jobs.'+job_name_instance.key)==null}"
										th:text="${@environment.getProperty('job_name.jobs.'+job_name_instance.key)}">job
										name</td>
									<td><span
										th:if="${job_name_executions.get(job_name_instance.key)!=null }"
										class="timeago"
										th:text="${job_name_executions.get(job_name_instance.key).createTime}"></span><span
										th:if="${job_name_executions.get(job_name_instance.key)!=null}"
										th:text="${#calendars.format(job_name_executions.get(job_name_instance.key).createTime,'dd MMM yyyy HH:mm')}"></span></td>
									<td><span
										th:if="${job_name_runtimes.get(job_name_instance.key)!=null}"
										th:text="${job_name_runtimes.get(job_name_instance.key)}"></span></td>
									<td></td>
									<td>
										<div class="btn-group"
											th:if="${job_name_instance.value!=null}">
											<button type="button"
												class="btn btn-xs btn-primary dropdown-toggle"
												data-toggle="dropdown">
												View <span class="caret"></span>
											</button>
											<ul class="dropdown-menu" role="menu">
												<li><a
													th:href="@{'/jobs/'+${job_name_instance.key}+'/'+${job_name_instance.value.id}+'/'+${job_name_executions.get(job_name_instance.key).id}}"
													href="#"
													th:text="${#messages.msg('label.job_instances.view_execution')}">View
														Execution</a></li>
												<li><a
													th:href="@{'/jobs/'+${job_name_instance.key}+'/'+${job_name_instance.value.id}}"
													href="#"
													th:text="${#messages.msg('label.job_instances.view_all_executions')}">View
														All Executions</a></li>
												<li><a th:href="@{'/jobs/'+${job_name_instance.key}}"
													href="#"
													th:text="${#messages.msg('label.job_instances.view_instances')}">View
														Instances</a></li>
											</ul>
										</div>
										<div
											th:unless="${#strings.startsWith(job_name_instance.key,'processDocument')}"
											class="btn-group"
											th:if="${job_name_executions.get(job_name_instance.key)==null or (job_name_executions.get(job_name_instance.key)!=null and job_name_executions.get(job_name_instance.key).status.toString() ne 'STARTED')}">
											<button type="button"
												class="btn btn-xs btn-warning dropdown-toggle"
												data-toggle="dropdown">
												Start <span class="caret"></span>
											</button>
											<ul class="dropdown-menu" role="menu">
												<li
													th:unless="${#strings.startsWith(job_name_instance.key,'processFile')}"><a
													th:href="@{'/jobs/'+${job_name_instance.key}+'/start'}"
													href="#"
													th:text="${#messages.msg('label.job_instances.start_restart')}">Start
														or restart</a></li>
												<li
													th:unless="${#strings.startsWith(job_name_instance.key,'processFile')}"><a
													th:href="@{'/jobs/'+${job_name_instance.key}+'/start'(forceNew=true)}"
													href="#"
													th:text="${#messages.msg('label.job_instances.start_force_new')}">Start
														force new</a></li>
												<li
													th:if="${#strings.startsWith(job_name_instance.key,'processFile')}"><a
													th:href="@{/jobList/__${job_name_instance.key}__}" href="#"
													th:text="${#messages.msg('label.job_instances.start_selecting')}">Start
														Selecting File</a></li>
											</ul>
										</div> <a class="btn btn-xs btn-danger"
										th:if="${job_name_instance.value!=null and job_name_executions.get(job_name_instance.key)!=null and job_name_executions.get(job_name_instance.key).status.toString() eq 'STARTED'}"
										th:href="@{'/jobs/'+${job_name_instance.key}+'/'+${job_name_instance.value.id}+'/'+${job_name_executions.get(job_name_instance.key).id}}+'/stop'"
										href="#"
										th:text="${#messages.msg('label.job_instances.stop')}">Stop
											Exection</a> <a
										th:unless="${#strings.startsWith(job_name_instance.key,'processDocument')}"
										class="btn btn-xs btn-info"
										th:href="@{'/jobs/'+${job_name_instance.key}+'/scheduler'}"
										href="#"><span class="glyphicon glyphicon-time"></span> <span
											th:text="${#messages.msg('label.job_instances.scheduler')}">Scheduler</span></a>
									</td>
								</tr>
							</tbody>
						</table>

						<div
							th:if="${#lists.isEmpty(job_instances) and #lists.isEmpty(job_name_instances)}">
							<span
								th:text="${#messages.msg('label.job_instances.warning.isEmpty')}">Warning
								job instances empty.</span>

						</div>
						<p th:if="${not #lists.isEmpty(job_instances)}">
							<a href="#" th:href="@{/jobs}"
								th:text="${#messages.msg('label.job_instances.other_jobs')}"></a>
						</p>

						<table class="table" th:if="${not #lists.isEmpty(job_instances)}">
							<thead>
								<tr>
									<th><span
										th:text="${#messages.msg('label.job_instances.job_name')}">Job
											Name</span></th>
									<th><span
										th:text="${#messages.msg('label.job_instances.last_runtime')}">Last
											Run Time</span></th>
									<th><span
										th:text="${#messages.msg('label.job_instances.last_result')}">Last
											Result</span></th>
									<th><span
										th:text="${#messages.msg('label.job_instances.action')}">Action</span></th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="instance : ${job_instances}">
									<td
										th:if="${@environment.getProperty('job_name.jobs.'+instance.jobName)==null}"
										th:text="${instance.jobName}">job name</td>
									<td
										th:unless="${@environment.getProperty('job_name.jobs.'+instance.jobName)==null}"
										th:text="${@environment.getProperty('job_name.jobs.'+instance.jobName)}">job
										name</td>
									<td th:if="${job_executions.get(instance.id)!=null}"><span
										th:if="${job_executions.get(instance.id)!=null}"
										class="timeago"
										th:text="${job_executions.get(instance.id).createTime}"></span><span
										th:if="${job_executions.get(instance.id)!=null}"></span></td>
									<td
										th:include="base :: job_status (${job_executions.get(instance.id)!=null?job_executions.get(instance.id).status.toString():'UNKNOWN'})">status</td>
									<td>
										<div class="btn-group">
											<button type="button"
												class="btn btn-xs btn-primary dropdown-toggle"
												data-toggle="dropdown">
												View <span class="caret"></span>
											</button>
											<ul class="dropdown-menu" role="menu">
												<li><a
													th:href="@{'/jobs/'+${instance.jobName}+'/'+${instance.id}+'/'+${job_executions.get(instance.id).id}}"
													href="#">View Execution</a></li>
												<li><a
													th:href="@{'/jobs/'+${instance.jobName}+'/'+${instance.id}}"
													href="#">View All Executions</a></li>
											</ul>
										</div>
									</td>
								</tr>
							</tbody>
						</table>

						<ul class="pager" th:if="${not #lists.isEmpty(job_instances)}">
							<li><a
								th:href="@{'/jobs/'+${job_name}(start=${start-10 lt 0 ? 0 : start-10})}"
								href="#">Newer</a></li>
							<li><a
								th:href="@{'/jobs/'+${job_name}(start=${job_instances.size() eq 10 ? start+10 : start})}"
								href="#">Older</a></li>
						</ul>
					</section>
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.panel -->
		</div>
		<!-- /.col-lg-8 -->
	</div>
	<!-- /.row -->
	<!-- /#wrapper -->

	<!-- jQuery -->
	<script src="../vendor/jquery/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="../vendor/metisMenu/metisMenu.min.js"></script>

	<!-- DataTables JavaScript -->
	<script src="../vendor/datatables/js/jquery.dataTables.min.js"></script>
	<script src="../vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
	<script src="../vendor/datatables-responsive/dataTables.responsive.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="../dist/js/sb-admin-2.js"></script>

	<!-- Page-Level Demo Scripts - Tables - Use for reference -->
	<script type="text/javascript">
		//<![CDATA[
		jQuery(document).ready(function() {
			jQuery("span.timeago").timeago();
			(window.formDocumentReady || function() {
			})();
			setTimeout(function() {
				$(".alert").alert('close');
			}, 8000);
		});
		$("ul#menu-list li#administration-list").addClass("active");
		//]]>
	</script>
</body>
</html>
